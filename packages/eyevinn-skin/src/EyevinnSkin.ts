import WebPlayer, { PlayerEvent, PlaybackState } from "@eyevinn/web-player-core";
import { createElement, IComponent } from "./util/element";
import style from "./style.module.scss";
import progressbar from "./components/progressbar";
import playPauseButton from "./components/playPauseButton";

export interface IEyevinnSkinOptions {
  wrapper: HTMLElement;
  player: WebPlayer;
}

export default class EyevinnSkin {
  private wrapper: HTMLElement;
  private player: WebPlayer;

  private container: HTMLDivElement;
  private controls: HTMLDivElement;

  private logo: HTMLImageElement;

  private playPauseButton: IComponent;
  private progressbar: IComponent;

  constructor({ wrapper, player }: IEyevinnSkinOptions) {
    this.wrapper = wrapper;
    this.player = player;

    this.setupDOM();
    this.setupEventListeners();
  }

  setupDOM() {
    this.wrapper.classList.add(style.skinWrapper);

    this.container = createElement("div", style.skinContainer);
    this.controls = createElement("div", style.controls);
    this.logo = createElement("img", style.logo);

    this.logo.src =
      "data:image/png;base64,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";

    this.playPauseButton = playPauseButton(() =>
      this.player.isPlaying ? this.player.pause() : this.player.play()
    );
    this.progressbar = progressbar((percentage) => this.player.seekTo({ percentage }));

    this.controls.appendChild(this.playPauseButton.element);
    this.controls.appendChild(this.progressbar.element);

    this.container.appendChild(this.logo);
    this.container.appendChild(this.controls);
    this.wrapper.appendChild(this.container);
  }

  setupEventListeners() {
    this.player.on(PlayerEvent.STATE_CHANGE, ({ state }) => {
      const { currentTime, duration, playbackState, isLive } = state; 
      if (duration === Infinity) {
        this.progressbar.hide();
      } else {
        this.progressbar.show();
        this.progressbar.update(currentTime, duration);
      }
      this.playPauseButton.update(playbackState === PlaybackState.PLAYING);
    });
  }
}
